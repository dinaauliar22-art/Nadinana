

/*
E-commerce single-file React app (App.jsx)
Instructions:
1) Create a new Vite React app (recommended):
   npm create vite@latest my-store -- --template react
   cd my-store
2) Install dependencies and Tailwind:
   npm install
   npm install -D tailwindcss postcss autoprefixer
   npx tailwindcss init -p
3) Configure Tailwind (tailwind.config.cjs):
   module.exports = {
     content: ['./index.html', './src/**/*.{js,jsx,ts,tsx}'],
     theme: { extend: {} },
     plugins: [],
   }
4) Add Tailwind directives to ./src/index.css:
   @tailwind base;
   @tailwind components;
   @tailwind utilities;
5) Replace ./src/App.jsx with this file. Ensure ./src/main.jsx imports './index.css'.
6) Run: npm run dev

This is a self-contained front-end demo (no backend). It includes:
- product listing, search, filters
- cart (localStorage)
- product detail modal
- checkout modal (mock)
- responsive layout, accessible buttons

Customize: connect to a backend or payments provider, swap sample data with API, add authentication, etc.
*/

import React, { useEffect, useMemo, useState } from 'react';

// Sample product dataset (replace with API data)
const SAMPLE_PRODUCTS = [
  { id: 'p1', title: 'Sneakers Blaze', price: 89.99, category: 'Shoes', rating: 4.5, img: 'https://picsum.photos/seed/p1/600/400', stock: 12, description: 'Comfortable everyday sneakers with breathable mesh.' },
  { id: 'p2', title: 'Classic Watch', price: 129.0, category: 'Accessories', rating: 4.7, img: 'https://picsum.photos/seed/p2/600/400', stock: 5, description: 'Minimal stainless steel watch, water resistant.' },
  { id: 'p3', title: 'Denim Jacket', price: 69.5, category: 'Clothing', rating: 4.2, img: 'https://picsum.photos/seed/p3/600/400', stock: 20, description: 'Slim fit denim jacket - durable & stylish.' },
  { id: 'p4', title: 'Bluetooth Headphones', price: 59.99, category: 'Electronics', rating: 4.3, img: 'https://picsum.photos/seed/p4/600/400', stock: 8, description: 'Noise-cancelling, long battery life.' },
  { id: 'p5', title: 'Running Shorts', price: 24.99, category: 'Clothing', rating: 4.0, img: 'https://picsum.photos/seed/p5/600/400', stock: 30, description: 'Lightweight, quick-dry running shorts.' },
  { id: 'p6', title: 'Leather Wallet', price: 39.0, category: 'Accessories', rating: 4.6, img: 'https://picsum.photos/seed/p6/600/400', stock: 15, description: 'Slim leather wallet with RFID protection.' },
];

function currency(n) {
  return n.toLocaleString('id-ID', { style: 'currency', currency: 'IDR' });
}

function useLocalStorageState(key, initial) {
  const [state, setState] = useState(() => {
    try {
      const s = localStorage.getItem(key);
      return s ? JSON.parse(s) : initial;
    } catch (e) { return initial; }
  });
  useEffect(() => { try { localStorage.setItem(key, JSON.stringify(state)); } catch (e) {} }, [key, state]);
  return [state, setState];
}

export default function App() {
  const [products] = useState(SAMPLE_PRODUCTS);
  const [query, setQuery] = useState('');
  const [category, setCategory] = useState('All');
  const [sort, setSort] = useState('popular');
  const [cart, setCart] = useLocalStorageState('cart-v1', []);
  const [selected, setSelected] = useState(null);
  const [showCheckout, setShowCheckout] = useState(false);
  const [successMessage, setSuccessMessage] = useState('');

  const categories = useMemo(() => ['All', ...Array.from(new Set(products.map(p => p.category)))], [products]);

  const filtered = useMemo(() => {
    const q = query.trim().toLowerCase();
    let res = products.filter(p => (
      (category === 'All' || p.category === category) &&
      (q === '' || p.title.toLowerCase().includes(q) || p.description.toLowerCase().includes(q))
    ));
    if (sort === 'price-asc') res = res.sort((a,b)=>a.price-b.price);
    if (sort === 'price-desc') res = res.sort((a,b)=>b.price-a.price);
    if (sort === 'rating') res = res.sort((a,b)=>b.rating-a.rating);
    return res;
  }, [products, query, category, sort]);

  function addToCart(product, qty = 1) {
    setCart(prev => {
      const existing = prev.find(i => i.id === product.id);
      if (existing) return prev.map(i => i.id === product.id ? { ...i, qty: Math.min(product.stock, i.qty + qty) } : i);
      return [...prev, { id: product.id, title: product.title, price: product.price, qty: Math.min(product.stock, qty) }];
    });
  }

  function updateQty(id, qty) {
    setCart(prev => prev.map(i => i.id === id ? { ...i, qty: Math.max(1, qty) } : i));
  }

  function removeFromCart(id) { setCart(prev => prev.filter(i => i.id !== id)); }

  const subtotal = cart.reduce((s, i) => s + i.price * i.qty, 0);
  const shipping = subtotal > 0 ? 25000 : 0; // flat shipping example
  const tax = subtotal * 0.1; // example 10%
  const total = subtotal + shipping + tax;

  function placeOrder({ name, address }) {
    // Mock order placement — in real app, call backend
    setShowCheckout(false);
    setCart([]);
    setSuccessMessage(`Terima kasih ${name}! Pesanan Anda sedang diproses dan akan dikirim ke ${address}.`);
    setTimeout(()=>setSuccessMessage(''), 8000);
  }

  return (
    <div className="min-h-screen bg-gray-50 text-gray-900">
      <header className="bg-white shadow">
        <div className="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="text-2xl font-bold">MyStore</div>
            <div className="hidden sm:flex items-center gap-2 text-sm text-gray-500">
              <span>Marketplace demo</span>
            </div>
          </div>
          <div className="flex items-center gap-4">
            <div className="relative">
              <input value={query} onChange={(e)=>setQuery(e.target.value)} placeholder="Cari produk..." className="border rounded-md px-3 py-1 w-48 focus:outline-none focus:ring" />
            </div>
            <button onClick={()=>setShowCheckout(true)} className="px-3 py-2 bg-indigo-600 text-white rounded-md shadow">Checkout ({cart.length})</button>
          </div>
        </div>
      </header>

      <main className="max-w-6xl mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-4 gap-8">
        <aside className="lg:col-span-1 space-y-4">
          <div className="bg-white p-4 rounded-lg shadow">
            <h3 className="font-semibold mb-2">Kategori</h3>
            <select value={category} onChange={(e)=>setCategory(e.target.value)} className="w-full border rounded px-2 py-1">
              {categories.map(c=> <option key={c} value={c}>{c}</option>)}
            </select>
          </div>

          <div className="bg-white p-4 rounded-lg shadow">
            <h3 className="font-semibold mb-2">Urutkan</h3>
            <select value={sort} onChange={(e)=>setSort(e.target.value)} className="w-full border rounded px-2 py-1">
              <option value="popular">Popular</option>
              <option value="price-asc">Harga: Rendah &uarr;</option>
              <option value="price-desc">Harga: Tinggi &darr;</option>
              <option value="rating">Rating</option>
            </select>
          </div>

          <CartPanel cart={cart} products={products} updateQty={updateQty} removeFromCart={removeFromCart} subtotal={subtotal} />
        </aside>

        <section className="lg:col-span-3">
          {successMessage && <div className="mb-4 p-3 bg-green-50 border border-green-200 text-green-800 rounded">{successMessage}</div>}

          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {filtered.map(product => (
              <article key={product.id} className="bg-white rounded-lg shadow overflow-hidden flex flex-col">
                <img src={product.img} alt={product.title} className="h-48 w-full object-cover" />
                <div className="p-4 flex-1 flex flex-col">
                  <h4 className="font-semibold text-lg">{product.title}</h4>
                  <p className="text-sm text-gray-500 flex-1">{product.description}</p>
                  <div className="mt-3 flex items-center justify-between">
                    <div className="text-xl font-bold">{currency(product.price)}</div>
                    <div className="flex items-center gap-2">
                      <button onClick={()=>setSelected(product)} className="px-3 py-1 border rounded">Detail</button>
                      <button onClick={()=>addToCart(product)} className="px-3 py-1 bg-indigo-600 text-white rounded">Add</button>
                    </div>
                  </div>
                </div>
              </article>
            ))}
          </div>
        </section>
      </main>

      <footer className="border-t py-6">
        <div className="max-w-6xl mx-auto px-4 text-sm text-gray-500">© {new Date().getFullYear()} MyStore — Demo e‑commerce</div>
      </footer>

      {/* Product detail modal */}
      {selected && (
        <Modal onClose={()=>setSelected(null)}>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <img src={selected.img} alt="" className="w-full h-64 object-cover rounded" />
            <div>
              <h3 className="text-2xl font-bold">{selected.title}</h3>
              <p className="text-gray-600 mt-2">{selected.description}</p>
              <div className="mt-4">
                <div className="text-xl font-semibold">{currency(selected.price)}</div>
                <div className="text-sm text-gray-500">Stock: {selected.stock} • Rating: {selected.rating}</div>
              </div>
              <div className="mt-6 flex items-center gap-3">
                <button onClick={()=>{ addToCart(selected); setSelected(null); }} className="px-4 py-2 bg-indigo-600 text-white rounded">Tambah ke keranjang</button>
                <button onClick={()=>setSelected(null)} className="px-4 py-2 border rounded">Tutup</button>
              </div>
            </div>
          </div>
        </Modal>
      )}

      {/* Checkout modal */}
      {showCheckout && (
        <Modal onClose={()=>setShowCheckout(false)}>
          <CheckoutForm cart={cart} subtotal={subtotal} shipping={shipping} tax={tax} total={total} onBack={()=>setShowCheckout(false)} onPlaceOrder={placeOrder} />
        </Modal>
      )}
    </div>
  );
}

function CartPanel({ cart, products, updateQty, removeFromCart, subtotal }){
  return (
    <div className="bg-white p-4 rounded-lg shadow">
      <h3 className="font-semibold mb-2">Keranjang</h3>
      {cart.length === 0 && <div className="text-sm text-gray-500">Keranjang kosong</div>}
      <ul className="space-y-3">
        {cart.map(item => (
          <li key={item.id} className="flex items-center gap-3">
            <div className="flex-1">
              <div className="font-medium">{item.title}</div>
              <div className="text-sm text-gray-500">{currency(item.price)} • x{item.qty}</div>
            </div>
            <div className="flex items-center gap-2">
              <button onClick={()=>updateQty(item.id, item.qty-1)} className="px-2 py-1 border rounded">-</button>
              <div className="w-8 text-center">{item.qty}</div>
              <button onClick={()=>updateQty(item.id, item.qty+1)} className="px-2 py-1 border rounded">+</button>
              <button onClick={()=>removeFromCart(item.id)} className="px-2 py-1 text-red-600">×</button>
            </div>
          </li>
        ))}
      </ul>
      <div className="mt-4 border-t pt-3 text-sm">
        <div className="flex items-center justify-between"><span>Subtotal</span><strong>{currency(subtotal)}</strong></div>
      </div>
    </div>
  );
}

function Modal({ children, onClose }){
  useEffect(()=>{
    function onKey(e){ if(e.key === 'Escape') onClose(); }
    document.addEventListener('keydown', onKey);
    return ()=>document.removeEventListener('keydown', onKey);
  }, [onClose]);

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">
      <div className="absolute inset-0 bg-black opacity-40" onClick={onClose} />
      <div className="relative bg-white rounded-lg shadow max-w-3xl w-full p-6 z-10">{children}</div>
    </div>
  );
}

function CheckoutForm({ cart, subtotal, shipping, tax, total, onBack, onPlaceOrder }){
  const [name, setName] = useState('');
  const [address, setAddress] = useState('');
  const [loading, setLoading] = useState(false);

  function submit(e){
    e.preventDefault();
    if(!name || !address) return alert('Lengkapi nama dan alamat');
    setLoading(true);
    setTimeout(()=>{
      onPlaceOrder({ name, address });
      setLoading(false);
    }, 900);
  }

  return (
    <form onSubmit={submit} className="space-y-4">
      <h3 className="text-xl font-semibold">Checkout</h3>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div>
          <label className="text-sm">Nama</label>
          <input value={name} onChange={(e)=>setName(e.target.value)} className="w-full border rounded px-2 py-2" />
        </div>
        <div>
          <label className="text-sm">Alamat</label>
          <input value={address} onChange={(e)=>setAddress(e.target.value)} className="w-full border rounded px-2 py-2" />
        </div>
      </div>

      <div className="bg-gray-50 p-3 rounded">
        <div className="flex items-center justify-between text-sm"><span>Subtotal</span><span>{currency(subtotal)}</span></div>
        <div className="flex items-center justify-between text-sm"><span>Ongkos kirim</span><span>{currency(shipping)}</span></div>
        <div className="flex items-center justify-between text-sm"><span>Tax</span><span>{currency(tax)}</span></div>
        <div className="flex items-center justify-between font-semibold mt-2"><span>Total</span><span>{currency(total)}</span></div>
      </div>

      <div className="flex items-center gap-3">
        <button type="button" onClick={onBack} className="px-4 py-2 border rounded">Kembali</button>
        <button type="submit" disabled={cart.length===0 || loading} className="px-4 py-2 bg-green-600 text-white rounded disabled:opacity-50">{loading ? 'Memproses...' : 'Bayar (Mock)'}</button>
      </div>
    </form>
  );
}

